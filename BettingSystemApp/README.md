# Betting System App - Обновленная версия

## Описание
Обновленная система ставок, работающая с SQL Server базой данных. Система поддерживает управление пользователями, ставками и отслеживание ставок пользователей.

## Структура базы данных

### Таблицы:
1. **Roles** - Роли пользователей (Admin, Editor, Director, User)
2. **Users** - Пользователи с балансом и количеством ставок
3. **Bets** - Ставки (коэффициенты) с командами, временем матча и коэффициентами
4. **UserBets** - Ставки пользователей с суммой и статусом

## Установка и настройка

### 1. Создание базы данных
1. Откройте SQL Server Management Studio
2. Подключитесь к вашему серверу
3. Выполните скрипт `create_database.sql`
4. Убедитесь, что база данных `SimpleBetting` создана

### 2. Настройка подключения
1. Откройте файл `BettingSystemApp/App.config`
2. Измените строку подключения в соответствии с вашим сервером:
   ```xml
   <add name="BettingSystem"
        connectionString="Data Source=YOUR_SERVER;Initial Catalog=SimpleBetting;Integrated Security=True;"
        providerName="System.Data.SqlClient" />
   ```

### 3. Компиляция и запуск
1. Откройте решение `BettingSystemApp.sln` в Visual Studio
2. Восстановите NuGet пакеты
3. Скомпилируйте проект
4. Запустите приложение

## Функциональность

### Роли пользователей:
- **Admin** - Полный доступ к системе, архивирование данных
- **Editor** - Управление ставками (добавление, редактирование, удаление)
- **Director** - Управление пользователями, генерация отчетов
- **User** - Обычный пользователь (для веб-интерфейса)

### Основные возможности:

#### Admin Panel:
- Просмотр пользователей с балансом и количеством ставок
- Просмотр всех ставок с коэффициентами
- Просмотр ставок пользователей
- Архивирование данных в CSV и TXT форматах
- Восстановление данных из архивов

#### Editor Panel:
- Добавление новых ставок с командами, временем и коэффициентами
- Редактирование существующих ставок
- Удаление ставок
- Автоматическая очистка прошедших ставок

#### Director Panel:
- Управление пользователями
- Просмотр ставок пользователей
- Генерация подробных отчетов
- Экспорт данных в различные форматы

## Структура проекта

```
BettingSystemApp/
├── Models/
│   ├── User.cs          # Модель пользователя
│   ├── Role.cs          # Модель роли
│   ├── Bet.cs           # Модель ставки
│   └── UserBet.cs       # Модель ставки пользователя
├── BettingContext.cs    # Контекст Entity Framework
├── AdminWindow.xaml     # Окно администратора
├── EditorWindow.xaml    # Окно редактора
├── DirectorWindow.xaml  # Окно директора
├── AddBetWindow.xaml    # Окно добавления ставки
├── EditBetWindow.xaml   # Окно редактирования ставки
└── App.config          # Конфигурация подключения
```

## Интеграция с веб-сайтом

Система готова для интеграции с веб-интерфейсом. Когда пользователи делают ставки на сайте, данные будут поступать в таблицу `UserBets`, и администраторы смогут управлять этими данными через десктопное приложение.

### Таблица UserBets содержит:
- UserBetID - уникальный идентификатор ставки
- UserID - ID пользователя
- BetID - ID ставки (коэффициента)
- Amount - сумма ставки
- DatePlaced - дата и время размещения ставки
- Status - статус ставки (Active, Won, Lost)

## Отчеты

Система генерирует следующие отчеты:
- **UserReport.txt** - Отчет о пользователях
- **BetReport.txt** - Отчет о ставках
- **UserBetReport.txt** - Отчет о ставках пользователей
- **DirectorUserReport.csv** - CSV отчет для директора

## Требования

- .NET Framework 4.7.2
- SQL Server 2012 или выше
- Entity Framework 6.5.1
- Newtonsoft.Json 13.0.3

## Поддержка

При возникновении проблем:
1. Проверьте подключение к базе данных
2. Убедитесь, что все таблицы созданы корректно
3. Проверьте права доступа к базе данных
4. Просмотрите логи приложения 