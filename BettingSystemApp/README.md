# Система ставок MAKMERIC

## Описание
Десктопное приложение для управления ставками с использованием WPF, Entity Framework и SQL Server.

## Установка и настройка

### 1. Создание базы данных
1. Откройте SQL Server Management Studio
2. Подключитесь к вашему SQL Server
3. Выполните скрипт `create_database.sql` для создания базы данных и таблиц

### 2. Добавление тестовых данных
**ВАЖНО**: Используйте файл `test_data_simple_fixed.sql` для избежания ошибок с датами.

Выполните скрипт `test_data_simple_fixed.sql` для добавления тестовых данных:
- Пользователи с разными ролями
- Тестовые ставки
- Ставки пользователей

**Альтернативно**: Можно использовать `test_data_fixed.sql` (с переменными) или другие скрипты.

### 3. Настройка подключения
Убедитесь, что строка подключения в `App.config` соответствует вашей конфигурации SQL Server:

```xml
<connectionStrings>
    <add name="BettingContext" 
         connectionString="Data Source=YOUR_SERVER;Initial Catalog=SimpleBetting;Integrated Security=True" 
         providerName="System.Data.SqlClient" />
</connectionStrings>
```

### 4. Сборка и запуск
1. Откройте решение `BettingSystemApp.sln` в Visual Studio
2. Восстановите NuGet пакеты
3. Соберите решение (Build → Build Solution)
4. Запустите приложение

## Тестовые аккаунты

После выполнения `test_data_simple.sql` будут созданы следующие пользователи:

| Логин | Пароль | Роль |
|-------|--------|------|
| admin | admin123 | Администратор |
| editor | editor123 | Редактор |
| director | director123 | Директор |
| user1 | user123 | Пользователь |
| user2 | user123 | Пользователь |

## Функциональность

### Администратор
- Просмотр всех пользователей, ставок и ставок пользователей
- Архивирование и разархивирование данных
- Управление системой

### Редактор
- Добавление новых ставок
- Редактирование существующих ставок
- Управление коэффициентами

### Директор
- Просмотр отчетов
- Аналитика по ставкам
- Управление пользователями

### Пользователь
- Просмотр доступных ставок
- Размещение ставок
- Просмотр истории ставок

## Архивирование данных

### Как работает архивирование:
1. **Архивирование**: Данные сохраняются в CSV и TXT файлы в папке с исполняемым файлом
2. **Разархивирование**: Данные восстанавливаются из архивных файлов в базу данных

### Файлы архива:
- `UsersArchive.csv` - архив пользователей
- `BetsArchive.csv` - архив ставок
- `UserBetsArchive.csv` - архив ставок пользователей

### Исправленные проблемы:
- ✅ Исправлены ошибки с датами в SQL скриптах
- ✅ Добавлено сообщение о количестве восстановленных записей
- ✅ Исправлена проблема с исчезновением данных при архивировании/разархивировании

## Структура проекта

```
BettingSystemApp/
├── Models/           # Модели данных
├── Windows/          # Окна приложения
├── BettingContext.cs # Контекст базы данных
└── App.config        # Конфигурация
```

## Технологии

- **WPF** - пользовательский интерфейс
- **Entity Framework 6** - ORM для работы с базой данных
- **SQL Server** - база данных
- **C#** - язык программирования

## Устранение неполадок

### Ошибка "Преобразование типа данных varchar в datetime"
- Используйте `test_data_simple.sql` вместо `test_data.sql`
- Убедитесь, что SQL Server поддерживает указанный формат даты

### Ошибка "Конфликт FOREIGN KEY"
- Выполните скрипты в правильном порядке: сначала `create_database.sql`, затем `test_data_simple.sql`
- Убедитесь, что база данных создана корректно

### Проблемы с архивированием
- Проверьте права доступа к папке с исполняемым файлом
- Убедитесь, что архивные файлы не открыты в других программах

## Поддержка

При возникновении проблем:
1. Проверьте логи приложения
2. Убедитесь в корректности строки подключения
3. Проверьте права доступа к базе данных 